{% extends 'partials/base.html' %}
{% load static %}
{% load widget_tweaks %}
{% load crispy_forms_tags %}
<html>
<head>
{% block title %} Agregar Activos {% endblock %}
</head>
<body>
{% block content %}
<!-- Esta es la zona donde se crean los mensajes exitantes con sweet alert -->
<div>
    <script src="//cdn.jsdelivr.net/npm/sweetalert2@11"></script>
        {% if messages %}
            {% for message in messages %}
                {% if message.tags == "error" %}
                <script>
                Swal.fire({
                    "title":"Error",
                    "text":"{{message}}",
                    "icon":"error",
                })
                </script>
                {% else %}
                <script>
                Swal.fire({
                    "title":"Excelente",
                    "text":"{{message}}",
                    "icon":"success",
                })
                </script>
                {% endif %}
            {% endfor %}
        {% endif %}
</div>
<hr>
<hr>
<hr>
<hr>
<div class="container">
<div class="card"  id="document" role="document">
    <form method="POST" class="post-form">
    
        <div class="card-header">
            <h4 class="card-title">Editar Activo</h4>
        </div>
        <div class="card-body" style="color:white">
            <div>
                {% csrf_token %}
                    <div class="col-12">
                            <div class="alert alert-secondary" role="alert">
                            <h4 style="color: #121212;">&nbsp;Activo:&nbsp;{{activo.eco_unidad}}</h4>   
                            </div>
                    </div>
                    <div class="col-12">
                        <div class="input-group mb-3">
                        <span class="input-group-text" id="basic-addon1"><i class="fa-solid fa-list"></i></span>
                            <div class="form-floating form-floating-group flex-grow-1">   
                                {{form.descripcion|add_class:"form-control"|append_attr:"placeholder= Descripción"}}
                                <label style="color: #121212;" for="id_lugar_partida">Descripción*</label>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                    <div class="col-6">
                        <div class="input-group mb-3">
                        <span class="input-group-text" id="basic-addon1"><i class="fa-solid fa-list"></i></span>
                        <div class="form-floating form-floating-group flex-grow-1">   
                            {{form.tipo_activo|add_class:"form-control"|append_attr:"placeholder= Tipo de Activo"}}
                            <label style="color: #121212;" for="id_lugar_partida">Tipo de Activo*</label>
                        </div>
                        </div>
                    </div>
                    <div class="col-6">
                        <div class="input-group mb-3">
                        <span class="input-group-text" id="basic-addon1"><i class="fa-solid fa-hashtag"></i></span>
                            <div class="form-floating form-floating-group flex-grow-1">   
                            {{form.eco_unidad|add_class:"form-control"|append_attr:"placeholder= Eco"}}
                            <label style="color: #121212;" for="id_lugar_partida">Eco*</label>
                            </div>
                        </div>
                    </div>
                    </div>
                    <div class="row">
                        <!--<div id='etiqueta_responsable' class="col-6">
                            <div class="alert alert-primary" role="alert">
                            <h6 style="color: #121212;">&nbsp;Responsable:&nbsp;{{activo.responsable.staff.staff.first_name}} {{activo.responsable.staff.staff.last_name}}</h6>   
                            </div>
                        </div>-->
                        <div class="col-4" id="input_personal">
                            {{form.responsable}}
                        </div>
                        <div id="etiqueta_marca" class="col-6">
                            <div class="alert alert-primary" role="alert">
                            <h6 style="color: #121212;">&nbsp;Marca:&nbsp;{{activo.marca}}</h6>   
                            </div>
                        </div>
                        <div class="col-12 d-none" id="input_marca">
                            {{form.marca}}
                        </div>    
                        <div class="row">
                            <div class="input-group mb-3">
                            <span class="input-group-text" id="basic-addon1"><i class="fa-solid fa-hashtag"></i></span>
                                <div class="form-floating form-floating-group flex-grow-1">   
                                {{form.serie|add_class:"form-control"|append_attr:"placeholder= Serie"}}
                                <label style="color: #121212;" for="id_lugar_partida">Serie</label>
                                </div>
                            </div>
                        </div>
                        <div class="col-6">
                            <div class="input-group mb-3">
                                <span class="input-group-text" id="basic-addon1"><i class="fa-solid fa-sliders"></i></span>
                                <div class="form-floating form-floating-group flex-grow-1">   
                                {{form.modelo|add_class:"form-control"|append_attr:"placeholder= Modelo"}}
                                <label style="color: #121212;" for="id_lugar_partida">Modelo</label>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="col-12">
                        <div class="input-group mb-3">
                        <span class="input-group-text" id="basic-addon1"><i class="fa-solid fa-message"></i></span>
                            <div class="form-floating form-floating-group flex-grow-1">   
                            {{form.comentario|add_class:"form-control"}}
                            <label style="color: #121212;" for="id_lugar_partida">Observaciones*</label>
                            </div>
                        </div>
                    </div>
            </div>
        </div>
        <div class="card-footer">
                <button class="btn btn-success" id="crear" type="submit">Crear</button>
                <a type="button" class="btn btn-secondary" id="cerrar" data-bs-dismiss="modal">Cerrar</a>
        </div>
   
    </form>
</div>
</div>
<!--Este es el modal-->
<div class="modal fade" id ="dialog" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" role="dialog">
    <div class="modal-dialog modal-lg modal-dialog-centered" id="document" role="document" hx-target="this">

    </div>
</div>
<!--AJAX CALL-->
<script src="https://code.jquery.com/jquery-3.6.0.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
<script src="//cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script>


document.getElementById('id_tipo_activo').addEventListener('change', (event) => {
aparecer_serie()  
});

document.addEventListener('DOMContentLoaded', function() {
    let serie = document.getElementById('serie');
    if (serie){
    aparecer_serie()  
    }
});

/*document.getElementById("etiqueta_responsable").addEventListener("dblclick", function(){
    var responsable = document.getElementById("etiqueta_responsable")
    var input_personal = document.getElementById("input_personal")
    input_personal.setAttribute("class","col-sm-6")
    responsable.setAttribute("class","col-6 d-none")
});*/
document.getElementById("etiqueta_marca").addEventListener("dblclick", function(){
    var marca = document.getElementById("etiqueta_marca")
    var input_marca = document.getElementById("input_marca")
    input_marca.setAttribute("class","col-sm-6")
    marca.setAttribute("class","col-6 d-none")
});

function aparecer_serie() {
    var tipo_activo = document.getElementById('id_tipo_activo');
    var serie = document.getElementById('serie');


    if (tipo_activo.value == 1){
        serie.classList.add('d-none')
}else {
    serie.classList.remove('d-none')
}
};

var datosResponsable= {{ responsables_para_select2|safe }};

$(document).ready(function() {
    $('#id_responsable').select2({
        allowClear: true,
        width: '100%',
        data: datosResponsable,
        placeholder: 'Responsable',
        templateResult: formatRepo, // Función para renderizar los resultados
        templateSelection: formatRepoSelection // Función para renderizar la selección
    });
    /*$('#id_supervisor').on('select2:select', function(e){
        var data = e.params.data;
        var datos = JSON.parse(localStorage.getItem("id_solicitud_"+orden_id));
        cambio_en_formulario(data,'supervisor') //Acá lo que hago es mediante esta función guardo los valores en el local storage
    });
    var datos = JSON.parse(localStorage.getItem("id_solicitud_"+orden_id));
    var supervisorSelect = $('#id_supervisor');
    //Si hay datos se rellena el campo con los datos del local storage
    if (datos) {
        if (datos.supervisor){
            var option = new Option(datos.supervisor_text, datos.supervisor, true, true);
            supervisorSelect.append(option).trigger('change');
            $('#id_supervisor').on('select2:unselect', function(e){

                datos.supervisor = '';
                datos.supervisor_text ='';
                localStorage.setItem("id_solicitud_" + orden_id, JSON.stringify(datos));

            })
        }
    }*/
});

$(document).ready(function() {
    $('#id_marca').select2({
        allowClear: true,
        width: '100%',
        placeholder: 'Marca',
        templateResult: formatRepo, // Función para renderizar los resultados
        templateSelection: formatRepoSelection // Función para renderizar la selección
    });
});

function formatRepo (repo) {
    if (repo.loading) {
        return repo.text;
    }

    var $container = $("<div class='select2-result-repository clearfix'>" +
        "<div class='form-control form-control-lg select2-result-repository__title'></div>" +
        "</div>");

    $container.find(".select2-result-repository__title").text(repo.text);
    
    // Aquí podrías agregar más elementos al contenedor si es necesario.

    return $container;
}
function formatRepoSelection (repo) {
    return repo.text || repo.id;
}

</script>
{% endblock %}

</body>
</html>