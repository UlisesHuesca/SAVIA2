{% load static %}
{% load i18n %}
<html>
<head>
   
{% block title %}

{% endblock %}
<h6>&nbsp;</h6>
<h6 class="d-lg-none">&nbsp;</h6>


</head>
<body>
{% block content %}
<div class="container">
    <div class="row m-4">
        <div class="col-md-12 col-lg-10">
            <div class="card" style="opacity: 0.8; background: hsla(0, 0%, 100%, 0.55); 
            backdrop-filter: blur(30px);">
                <div class="card-header text-center">
                    <strong>
                        <img class="rounded-circle" src="{% static 'images/SAVIA_Logo.png' %}" id="logo" alt="SAVIA" style="width: 220px; height: 220px;">
                        <h1 style="color: #122D45">SAVIA 2.0</h1>
                        {% if usuario.tipo.proveedor_externo %}<h4>Portal de Proveedor de Grupo Vordcab</h4>{% endif %}
                    </strong>
                </div>
                <div class="card-body">
                    {% if usuario.tipo.comprador == True %}
                    <div class="row mt-1">
                        <div class="col-md-4">
                            <a class="text-decoration-none text-dark" href="{% url 'requisicion-autorizada'  %}">
                                <div class="card my-card shadow text-center p-3">
                                    <h4>Requisiciones Autorizadas <i class="fa-solid fa-bag-shopping"></i></h4>
                                    <h3></h3>
                                </div>
                            </a>
                        </div>
                        <div class="col-md-4">
                            <a class="text-decoration-none text-dark" href="{% url 'matriz-compras' %}">
                                <div class="card my-card shadow text-center p-3">
                                    <h4>Reporte de Compras<i class="fa-solid fa-cart-shopping"></i></h4>
                                    <h3></h3>
                                </div>
                            </a>
                        </div>
                        <div class="col-md-4">
                            <a class="text-decoration-none text-dark" href="{% url 'comparativos' %}">
                                <div class="card my-card shadow text-center p-3">
                                    <h4>Comparativos <i class="fa-solid fa-scale-unbalanced-flip"></i></h4>
                                    <h3></h3>
                                </div>
                            </a>
                        </div>
                    </div>
                    {%else%}
                    {% if usuario.tipo.proveedor_externo == False %}
                    <div class="row mt-1">
                        <div class="col-md-4">
                            <a class="text-decoration-none text-dark" href="#">
                                <div class="card my-card shadow text-center p-3">
                                    <h4>Personal <i class="fa-solid fa-users"></i></h4>
                                    <h3>{{conteo_usuario}}</h3>
                                </div>
                            </a>
                        </div>
                        <div class="col-md-4">
                            <a class="text-decoration-none text-dark" href="{% url 'dashboard-product' %}">
                                <div class="card my-card shadow text-center p-3">
                                    <h4>{% trans "Productos" %} <i class="fa-solid fa-box"></i></h4>
                                    <h3>{{conteo_productos}}</h3>
                                </div>
                            </a>
                        </div>
                        <div class="col-md-4">
                            <a class="text-decoration-none text-dark" href="{% url 'solicitudes-pendientes' %}">
                                <div class="card my-card shadow text-center p-3">
                                    <h4>{% trans "Solicitudes" %} <i class="fa-solid fa-truck-fast"></i></h4>
                                    <h3>{{solicitudes_generadas}}</h3>
                                </div>
                            </a>
                        </div>
                        
                    </div>
                    {% endif %}
                    {% endif %}
                    {% if usuario.tipo.proveedor_externo == False %}
                    <div class="row mt-2">
                        <div class="col-md-4">
                            <a class="text-decoration-none text-dark"  href="{% url 'user-profile' %}">
                                <div class="card my-card shadow text-center p-3">
                                    <h4>Perfil <i class="fa-solid fa-user"></i></h4>
                                    <h3></h3>
                                </div>
                            </a>
                        </div>
                        <div class="col-md-4">
                            <a class="text-decoration-none text-dark"  href="{% url 'solicitud-product-selection' %}">
                                <div class="card my-card shadow text-center p-3">
                                    <h4>{% trans "Crear Solicitud" %} <i class="fa-solid fa-pen-to-square"></i></h4>
                                    <h3></h3>
                                </div>
                            </a>
                        </div>
                        <div class="col-md-4">
                            <a class="text-decoration-none text-dark"  href="{% url 'solicitudes-pendientes' %}">
                                <div class="card my-card shadow text-center p-3">
                                    <h4>{% trans "Solicitud Status" %}<i class="fa-solid fa-shoe-prints"></i></h4>
                                    <h3></h3>
                                </div>
                            </a>
                        </div>   
                    </div>
                    {% endif %} 
                    {% if usuario.tipo.proveedor_externo %}
                    <div class="row mt-2">
                        <div class="col-md-4">
                            <a class="text-decoration-none text-dark"  href="{% url 'matriz-oc-proveedores' %}" title="Ordenes de Compra">
                                <div class="card my-card shadow text-center p-3">
                                    <h4>Compras <i class="fa-solid fa-user"></i></h4>
                                    <h3></h3>
                                </div>
                            </a>
                        </div>
                        <div class="col-md-4">
                            <a class="text-decoration-none text-dark"  href="{% url 'matriz-direcciones' %}" title="Auditoría de Proveedores">
                                <div class="card my-card shadow text-center p-3">
                                    <h4>Información <i class="fa-solid fa-user"></i></h4>
                                    <h3></h3>
                                </div>
                            </a>
                        </div>
                        <div class="col-md-4">
                            <a id="btnVerPolitica" type="button" class="text-decoration-none text-dark" class="btn btn-outline-info" data-bs-toggle="modal" data-bs-target="#pdfModal" title="Política Antisoborno">
                                <div class="card my-card shadow text-center p-3">
                                    <h4>Política Antisoborno <i class="fa-duotone fa-solid fa-book"></i></h4>
                                    <h3></h3>
                                </div>
                            </a>
                           
                       
                        </div>
                    </div>
                   
                    {% endif %}
                </div>
                  <!-- Modal con visor de PDF -->
                  
            </div>
            <div class="modal fade" id="pdfModal" tabindex="-1" aria-labelledby="pdfModalLabel" aria-hidden="true" data-bs-backdrop="static" data-bs-keyboard="false">
                <div class="modal-dialog modal-xl">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title" id="pdfModalLabel">Política Antisoborno</h5>
                            <!--<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>-->
                        </div>
                        <div class="modal-body p-0">
                            <iframe id="iframePolitica" src="" style="border:none;" width="100%" height="750px"></iframe>
                        </div>
                        <div class="modal-footer">
                            <div class="form-check me-auto">
                              <label class="form-check-label" for="checkAceptar">
                                Acepto haber leído y comprendido la política antisoborno.
                              </label>
                            </div>
                            <button type="button" class="btn btn-primary" id="btnAceptarPolitica">Aceptar</button>
                        </div>
                    </div>
                </div>
              </div>
        </div>

    </div>
</div>
<script>
    document.addEventListener('DOMContentLoaded', function () {
        const iframe = document.getElementById('iframePolitica');
        const modalElement = document.getElementById('pdfModal');
        const modal = new bootstrap.Modal(modalElement);
        const btnAceptar = document.getElementById('btnAceptarPolitica');
        console.log(btnAceptar);

        document.getElementById('btnVerPolitica').addEventListener('click', function () {
            fetch("{% url 'ver-politica-pdf' %}")
                .then(response => response.json())
                .then(data => {
                    // Reemplazamos las barras invertidas \\ por normales /
                    const url = data.url.replace(/\\/g, '/');
                    iframe.src = url + "#zoom=80";
                    modal.show();
                });
        });
        btnAceptar.addEventListener('click', function () {
        fetch("{% url 'aceptar-politica' %}", {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'X-CSRFToken': getCookie('csrftoken')
            },
            body: JSON.stringify({ aceptado: true })
        })
        .then(response => {
            if (!response.ok) throw new Error('Error al guardar');
            return response.json();
        })
        .then(data => {
            modal.hide();  // Cierra el modal
            console.log('Política aceptada');
        })
        .catch(error => {
            alert('Ocurrió un error al aceptar la política');
            console.error(error);
        });
    });

    // Función para obtener el CSRF token
    function getCookie(name) {
        let cookieValue = null;
        if (document.cookie && document.cookie !== '') {
            const cookies = document.cookie.split(';');
            for (let i = 0; i < cookies.length; i++) {
                const cookie = cookies[i].trim();
                if (cookie.substring(0, name.length + 1) === (name + '=')) {
                    cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                    break;
                }
            }
        }
        return cookieValue;
    }
});
        
</script>
{% endblock %}
</body>
</html>