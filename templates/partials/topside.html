{% load static %}
{% load i18n %}
<html>
<head>
<meta name="csrf-token" content="{{ csrf_token }}">
{% block title %}

{% endblock %}

<h6>&nbsp;</h6>
<h6 class="d-lg-none">&nbsp;</h6>



</head>

<body>
{% block content %}
<div class="row my-4">
    <div class="col-md-4">
    <script src="//cdn.jsdelivr.net/npm/sweetalert2@11"></script>
        {% if messages %}
            {% for message in messages %}
                {% if message.tags == "error" %}
                <script>
                Swal.fire({
                    "title": "Error",
                    "text": "{{ message }}",
                    "icon": "error",
                })
                </script>
                {% elif message.tags == "warning" %}
                <script>
                Swal.fire({
                    "title": "Facturas repetidas",
                    "text": "{{ message }}",
                    "icon": "warning",
                })
                </script>
                {% else %}
                <script>
                Swal.fire({
                    "title": "Excelente",
                    "text": "{{ message }}",
                    "icon": "success",
                })
                </script>
                {% endif %}
            {% endfor %}
        {% endif %}
    </div>
</div>
<div class="container">
    
    <div class="row m-4">
        <div class="col-md-12 col-lg-10">
            <div class="card" style="opacity: 0.8; background: hsla(0, 0%, 100%, 0.55); 
            backdrop-filter: blur(30px);">
                <div class="card-header text-center">
                    <strong>
                        <img class="rounded-circle" src="{% static 'images/SAVIA_Logo.png' %}" id="logo" alt="SAVIA" style="width: 220px; height: 220px;">
                        <!--<img class="rounded-circle" src="{% static 'images/SAVIA_navide√±o.jpg' %}" id="logo" alt="SAVIA" style="width: 220px; height: 220px;">-->
                        <h1 style="color: #122D45">SAVIA 2.0</h1>
                        {% if usuario.tipo.proveedor_externo %}
                            {% if prealta %}<h4>Portal de Proveedor de Grupo Vordcab | PREALTA</h4>
                            {% else %}<h4>Portal de Proveedor de Grupo Vordcab</h4>
                            {% endif %}
                        {% endif %}
                    </strong>
                </div>
                <div class="card-body">
                    {% if usuario.tipo.comprador == True %}
                    <div class="row mt-1">
                        <div class="col-md-4">
                            <a class="text-decoration-none text-dark" href="{% url 'requisicion-autorizada'  %}">
                                <div class="card my-card shadow text-center p-3">
                                    <h4>Requisiciones Autorizadas <i class="fa-solid fa-bag-shopping"></i></h4>
                                    <h3></h3>
                                </div>
                            </a>
                        </div>
                        <div class="col-md-4">
                            <a class="text-decoration-none text-dark" href="{% url 'matriz-compras' %}">
                                <div class="card my-card shadow text-center p-3">
                                    <h4>Reporte de Compras<i class="fa-solid fa-cart-shopping"></i></h4>
                                    <h3></h3>
                                </div>
                            </a>
                        </div>
                        <div class="col-md-4">
                            <a class="text-decoration-none text-dark" href="{% url 'comparativos' %}">
                                <div class="card my-card shadow text-center p-3">
                                    <h4>Comparativos <i class="fa-solid fa-scale-unbalanced-flip"></i></h4>
                                    <h3></h3>
                                </div>
                            </a>
                        </div>
                    </div>
                    {% else %}
                        {% if usuario.tipo.proveedor_externo == False %}
                            {% if usuario.tipo.subdirector %}
                            <div class="row mt-2">
                                <div class="col-md-4">
                                    <a class="text-decoration-none text-dark"  href="{% url 'autorizacion-oc1' %}">
                                        <div class="card my-card shadow text-center p-3">
                                            <h4>Compras por Autorizar </h4>
                                            {% if conteo_oc1 == 0 %}
                                            <h3><span class="badge bg-primary"><i class="fa-solid fa-mug-hot"></i></span></h3>
                                            {% else %}
                                            <h3><span class="badge bg-danger">({{conteo_oc1}})</span></h3>
                                            {% endif %}
                                        </div>
                                    </a>
                                </div>
                                
                                <div class="col-md-4">
                                    <a class="text-decoration-none text-dark" href="{% url 'gastos-pendientes-autorizar' %}">
                                        <div class="card my-card shadow text-center p-3">
                                            <h4>Gastos por Autorizar </h4>
                                            {% if conteo_gastos_pendientes == 0 %}
                                            <h3><span class="badge bg-primary"><i class="fa-solid fa-mug-hot"></i></span></h3>
                                            {% else %}
                                            <h3><span class="badge bg-danger">({{conteo_gastos_pendientes}})</span></h3>
                                            {% endif %}
                                        </div>
                                    </a>
                                </div>
                                <div class="col-md-4">
                                    <a class="text-decoration-none text-dark" href="{% url 'viaticos-pendientes-autorizar' %}">
                                        <div class="card my-card shadow text-center p-3">
                                            <h4>Vi√°ticos por Autorizar<span class="badge bg-primary">1</span></h4>
                                            {% if conteo_viaticos == 0 %}
                                            <h3><span class="badge bg-primary"><i class="fa-solid fa-mug-hot"></i></span></h3>
                                            {% else %}
                                            <h3><span class="badge bg-danger">({{conteo_viaticos}})</span></h3>
                                            {% endif %}
                                        </div>
                                    </a>
                                </div>
                            </div>
                            {% elif usuario.tipo.oc_gerencia %}
                            <div class="row mt-2">
                                <div class="col-md-4">
                                    <a class="text-decoration-none text-dark"  href="{% url 'autorizacion-oc1' %}">
                                        <div class="card my-card shadow text-center p-3">
                                            <h4>Compras por Autorizar </h4>
                                            {% if conteo_oc == 0 %}
                                            <h3><span class="badge bg-primary"><i class="fa-solid fa-mug-hot"></i></span></h3>
                                            {% else %}
                                            <h3><span class="badge bg-danger">({{conteo_oc}})</span></h3>
                                            {% endif %}
                                        </div>
                                    </a>
                                </div>
                                
                                <div class="col-md-4">
                                    <a class="text-decoration-none text-dark" href="{% url 'gastos-pendientes-autorizar2' %}">
                                        <div class="card my-card shadow text-center p-3">
                                            <h4>Gastos por Autorizar </h4>
                                            {% if conteo_gastos_gerencia == 0 %}
                                            <h3><span class="badge bg-primary"><i class="fa-solid fa-mug-hot"></i></span></h3>
                                            {% else %}
                                            <h3><span class="badge bg-danger">({{conteo_gastos_gerencia}})</span></h3>
                                            {% endif %}
                                        </div>
                                    </a>
                                </div>
                                <div class="col-md-4">
                                    <a class="text-decoration-none text-dark" href="{% url 'viaticos-pendientes-autorizar2' %}">
                                        <div class="card my-card shadow text-center p-3">
                                            <h4>Vi√°ticos por Autorizar</h4>
                                            {% if conteo_viaticos_gerencia == 0 %}
                                            <h3><span class="badge bg-primary"><i class="fa-solid fa-mug-hot"></i></span></h3>
                                            {% else %}
                                            <h3><span class="badge bg-danger">({{conteo_viaticos_gerencia}})</span></h3>
                                            {% endif %}
                                        </div>
                                    </a>
                                </div>
                            </div>
                            {% elif usuario.tipo.superintendente and usuario.distritos.nombre != "MATRIZ" or usuario.tipo.supervisor and usuario.distritos.nombre == "MATRIZ" %}
                            
                            <div class="row mt-2">
                                <div class="col-md-4">
                                    <a class="text-decoration-none text-dark" href="{% url 'solicitud-pendientes-autorizacion' %}">
                                        <div class="card my-card shadow text-center p-3">
                                            <h4>Solicitudes por Autorizar </h4>
                                            {% if conteo_solicitudes == 0 %}
                                                <h3><span class="badge bg-primary"><i class="fa-solid fa-mug-hot"></i></span></h3>
                                            {% else %}
                                                <h3><span class="badge bg-danger">({{conteo_solicitudes}})</span></h3>
                                            {% endif %}
                                        </div>
                                    </a>
                                </div>
                                 <div class="col-md-4">
                                        <a class="text-decoration-none text-dark" href="{% url 'requisicion-autorizacion' %}">
                                            <div class="card my-card shadow text-center p-3">
                                                <h4>Requis por Autorizar </h4>
                                                {% if conteo_requis_pendientes == 0 %}
                                                    <h3><span class="badge bg-primary"><i class="fa-solid fa-mug-hot"></i></span></h3>
                                                {% else %}
                                                    <h3><span class="badge bg-danger">({{conteo_requis_pendientes}})</span></h3>
                                                {% endif %}
                                            </div>
                                        </a>
                                </div>
                                {% if usuario.tipo.superintendente %}
                                <div class="col-md-4">
                                    <a class="text-decoration-none text-dark" href="{% url 'gastos-pendientes-autorizar' %}">
                                        <div class="card my-card shadow text-center p-3">
                                            <h4>Gastos por Autorizar </h4>
                                            {% if conteo_gastos_pendientes == 0 %}
                                            <h3><span class="badge bg-primary"><i class="fa-solid fa-mug-hot"></i></span></h3>
                                            {% else %}
                                            <h3><span class="badge bg-danger">({{conteo_gastos_pendientes}})</span></h3>
                                            {% endif %}
                                        </div>
                                    </a>
                                </div>
                                {% else %}
                                <div class="col-md-4">
                                    <a class="text-decoration-none text-dark" href="{% url 'mis-comprobaciones-gasto' %}">
                                        <div class="card my-card shadow text-center p-3">
                                            <h4>Mis Comprobaciones </h4>
                                            <h3><span class="badge bg-secondary"><i class="fa-solid fa-money-bill"></i></span></h3>
                                        </div>
                                    </a>
                                </div>
                                {% endif %}

                            </div>
                            {% elif usuario.tipo.supervisor and usuario.distritos.nombre != "MATRIZ" %}
                            <div class="row mt-2">
                                <div class="col-md-4">
                                    <a class="text-decoration-none text-dark" href="{% url 'solicitud-pendientes-autorizacion' %}">
                                        <div class="card my-card shadow text-center p-3">
                                            <h4>Solicitudes por Autorizar </h4>
                                            {% if conteo_solicitudes == 0 %}
                                                <h3><span class="badge bg-primary"><i class="fa-solid fa-mug-hot"></i></span></h3>
                                            {% else %}
                                                <h3><span class="badge bg-danger">({{conteo_solicitudes}})</span></h3>
                                            {% endif %}
                                        </div>
                                    </a>
                                </div>
                                <div class="col-md-4">
                                    <a class="text-decoration-none text-dark" href="{% url 'mis-comprobaciones-gasto' %}">
                                        <div class="card my-card shadow text-center p-3">
                                            <h4>Mis Comprobaciones </h4>
                                            <h3><span class="badge bg-secondary"><i class="fa-solid fa-money-bill"></i></span></h3>
                                        </div>
                                    </a>
                                </div>
                                <div class="col-md-4">
                                    <a class="text-decoration-none text-dark"  href="{% url 'user-profile' %}">
                                        <div class="card my-card shadow text-center p-3">
                                            <h4>Perfil</h4>
                                            <h3><span class="badge bg-secondary"><i class="fa-solid fa-user"></i></span> </h3>
                                        </div>
                                    </a>
                                </div>
                            </div>
                            {% else %}
                                <div class="row mt-1">
                                    <div class="col-md-4">
                                        <a class="text-decoration-none text-dark" href="{% url 'staff' %}">
                                            <div class="card my-card shadow text-center p-3">
                                                <h4>Personal <i class="fa-solid fa-users"></i></h4> 
                                                <h3><span class="badge bg-primary">{{conteo_usuario}}</span></h3>
                                            </div>
                                        </a>
                                    </div>
                                    <!--<div class="col-md-4">
                                        <a class="text-decoration-none text-dark" href="#">
                                            <div class="card my-card shadow text-center p-3">
                                                <h4>Personal <i class="fa-solid fa-users"></i></h4>
                                                <h3>{{conteo_usuario}}</h3>
                                            </div>
                                        </a>
                                    </div>-->
                                    <div class="col-md-4">
                                        <a class="text-decoration-none text-dark"  href="{% url 'user-profile' %}">
                                            <div class="card my-card shadow text-center p-3">
                                                <h4>Perfil</h4>
                                                <h3><span class="badge bg-secondary"><i class="fa-solid fa-user"></i></span> </h3>
                                            </div>
                                        </a>
                                    </div>

                                    <div class="col-md-4">
                                        <a class="text-decoration-none text-dark" href="{% url 'solicitudes-pendientes' %}">
                                            <div class="card my-card shadow text-center p-3">
                                                <h4>{% trans "Solicitudes" %} <i class="fa-solid fa-truck-fast"></i></h4>
                                                <h3>{{solicitudes_generadas}}</h3>
                                            </div>
                                        </a>
                                    </div>
                                    
                                </div>
                            {% endif %}
                        {% endif %}
                    {% endif %}
                    {% if usuario.tipo.proveedor_externo == False %}
                         {% if usuario.tipo.subdirector %}
                            <div class="row mt-2">
                                <div class="col-md-4">
                                    <a class="text-decoration-none text-dark" href="{% url 'viaticos-pendientes-autorizar2' %}">
                                        <div class="card my-card shadow text-center p-3">
                                            <h4>Vi√°ticos por Autorizar<span class="badge bg-primary">2</span></h4>
                                            {% if conteo_viaticos_gerencia == 0 %}
                                            <h3><span class="badge bg-primary"><i class="fa-solid fa-mug-hot"></i></span></h3>
                                            {% else %}
                                            <h3><span class="badge bg-danger">({{conteo_viaticos_gerencia}})</span></h3>
                                            {% endif %}
                                        </div>
                                    </a>
                                </div>
                                <div class="col-md-4">
                                        <a class="text-decoration-none text-dark" href="{% url 'requisicion-autorizacion' %}">
                                            <div class="card my-card shadow text-center p-3">
                                                <h4>Requis por Autorizar </h4>
                                                {% if conteo_requis_pendientes == 0 %}
                                                    <h3><span class="badge bg-primary"><i class="fa-solid fa-mug-hot"></i></span></h3>
                                                {% else %}
                                                    <h3><span class="badge bg-danger">({{conteo_requis_pendientes}})</span></h3>
                                                {% endif %}
                                            </div>
                                        </a>
                                </div>
                                <div class="col-md-4">
                                        <a class="text-decoration-none text-dark" href="{% url 'solicitud-pendientes-autorizacion' %}">
                                            <div class="card my-card shadow text-center p-3">
                                                <h4>Solicitudes por Autorizar </h4>
                                                {% if conteo_solicitudes == 0 %}
                                                    <h3><span class="badge bg-primary"><i class="fa-solid fa-mug-hot"></i></span></h3>
                                                {% else %}
                                                    <h3><span class="badge bg-danger">({{conteo_solicitudes}})</span></h3>
                                                {% endif %}
                                            </div>
                                        </a>
                                </div>
                            </div>
                            {% elif usuario.tipo.oc_gerencia %}
                            <div class="row mt-2">
                               
                                
                                <div class="col-md-4">
                                    <a class="text-decoration-none text-dark" href="{% url 'vales-rosa-pendientes-autorizar' %}">
                                        <div class="card my-card shadow text-center p-3">
                                            <h4>Vales por Autorizar </h4>
                                            {% if conteo_vales == 0 %}
                                            <h3><span class="badge bg-primary"><i class="fa-solid fa-mug-hot"></i></span></h3>
                                            {% else %}
                                                <span class="badge bg-danger">({{conteo_vales}})</span>
                                            {% endif %}
                                        </div>
                                    </a>
                                </div>
                                <div class="col-md-4">
                                        <a class="text-decoration-none text-dark" href="{% url 'requisicion-autorizacion' %}">
                                            <div class="card my-card shadow text-center p-3">
                                                <h4>Requis por Autorizar </h4>
                                                {% if conteo_requis_pendientes == 0 %}
                                                    <h3><span class="badge bg-primary"><i class="fa-solid fa-mug-hot"></i></span></h3>
                                                {% else %}
                                                    <h3><span class="badge bg-danger">({{conteo_requis_pendientes}})</span></h3>
                                                {% endif %}
                                            </div>
                                        </a>
                                </div>
                                <div class="col-md-4">
                                    <a class="text-decoration-none text-dark" href="{% url 'solicitud-pendientes-autorizacion' %}">
                                        <div class="card my-card shadow text-center p-3">
                                            <h4>Solicitudes por Autorizar </h4>
                                            {% if conteo_solicitudes == 0 %}
                                                <h3><span class="badge bg-primary"><i class="fa-solid fa-mug-hot"></i></span></h3>
                                            {% else %}
                                                <h3><span class="badge bg-danger">({{conteo_solicitudes}})</span></h3>
                                            {% endif %}
                                        </div>
                                    </a>
                                </div>
                                <!--<div class="col-md-4">
                                    <a class="text-decoration-none text-dark" href="{% url 'staff' %}">
                                        <div class="card my-card shadow text-center p-3">
                                            <h4>Personal <i class="fa-solid fa-users"></i></h4> 
                                            <h3><span class="badge bg-primary">{{conteo_usuario}}</span></h3>
                                        </div>
                                    </a>
                                </div>-->
                            </div>
                            {% elif usuario.tipo.superintendente and usuario.distritos.nombre != "MATRIZ" %}
                            <div class="row mt-2">
                                <div class="col-md-4">
                                    <a class="text-decoration-none text-dark" href="{% url 'viaticos-pendientes-autorizar' %}">
                                        <div class="card my-card shadow text-center p-3">
                                            <h4>Vi√°ticos por Autorizar</h4>
                                            {% if conteo_viaticos == 0 %}
                                            <h3><span class="badge bg-primary"><i class="fa-solid fa-mug-hot"></i></span></h3>
                                            {% else %}
                                            <h3><span class="badge bg-danger">({{conteo_viaticos}})</span></h3>
                                            {% endif %}
                                        </div>
                                    </a>
                                </div>
                                {% if usuario.tipo.oc_superintendencia %}
                                <div class="col-md-4">
                                    <a class="text-decoration-none text-dark"  href="{% url 'autorizacion-oc1' %}">
                                        <div class="card my-card shadow text-center p-3">
                                            <h4>Compras por Autorizar </h4>
                                            {% if conteo_oc1 == 0 %}
                                            <h3><span class="badge bg-primary"><i class="fa-solid fa-mug-hot"></i></span></h3>
                                            {% else %}
                                            <h3><span class="badge bg-danger">({{conteo_oc1}})</span></h3>
                                            {% endif %}
                                        </div>
                                    </a>
                                </div>
                                <div class="col-md-4">
                                    <a class="text-decoration-none text-dark"  href="{% url 'compras-por-pagar' %}">
                                        <div class="card my-card shadow text-center p-3">
                                            <h4>Compras por Pagar </h4>
                                            {% if conteo_pagos2 == 0 %}
                                            <h3><span class="badge bg-primary"><i class="fa-solid fa-mug-hot"></i></span></h3>
                                            {% else %}
                                            <h3><span class="badge bg-danger">({{conteo_pagos2}})</span></h3>
                                            {% endif %}
                                        </div>
                                    </a>
                                </div>
                                {% endif %}
                            </div>
                            {% else %}
                            <div class="row mt-2">
                                
                                <div class="col-md-4">
                                    <a class="text-decoration-none text-dark"  href="{% url 'solicitud-product-selection' %}">
                                        <div class="card my-card shadow text-center p-3">
                                            <h4>{% trans "Crear Solicitud" %} <i class="fa-solid fa-pen-to-square"></i></h4>
                                            <h3></h3>
                                        </div>
                                    </a>
                                </div>
                                <div class="col-md-4">
                                    <a class="text-decoration-none text-dark"  href="{% url 'solicitudes-pendientes' %}">
                                        <div class="card my-card shadow text-center p-3">
                                            <h4>{% trans "Solicitud Status" %}<i class="fa-solid fa-shoe-prints"></i></h4>
                                            <h3></h3>
                                        </div>
                                    </a>
                                </div>   
                            
                            </div>
                        {% endif %}
                    {% endif %} 
                    {% if usuario.tipo.proveedor_externo %}
                        {% if prealta %}
                        <div class="row mt-2">
                            
                            <div class="col-md-4">
                                <a id="btnVerPolitica" type="button" class="text-decoration-none text-dark btn btn-outline-info" data-bs-toggle="modal" data-bs-target="#pdfModal" title="Pol√≠ticas y C√≥digos">
                                    <div class="card my-card shadow text-center p-3">
                                        
                                        <h4>Pol√≠ticas y C√≥digos 
                                            {% if mostrar_modal %}<i class="fa-solid fa-circle-1 text-danger"></i>
                                            {% else %}<i class="fa-solid fa-circle-1 text-success"></i>
                                            {% endif %}
                                        </h4>

                                       
                                       
                                        <h3></h3>
                                    </div>
                                </a>
                            </div>
                            <div class="col-md-4">
                                <a class="text-decoration-none text-dark"  href="{% url 'matriz-direcciones' %}" title="Auditor√≠a de Proveedores">
                                    <div class="card my-card shadow text-center p-3">
                                        <h4>Subir Documentos 
                                            {% if usuario.proveedor.documentos_completos %}<i class="fa-solid fa-circle-2 text-success"></i>
                                            {% else %}<i class="fa-solid fa-circle-2 text-danger"></i>
                                            {% endif %}
                                        </h4>
                                        <h3></h3>
                                    </div>
                                </a>
                            </div>
                            <div class="col-md-4">
                                <a class="text-decoration-none text-dark"  href="{% url 'cuestionario' usuario.proveedor.id %}">
                                    <div class="card my-card shadow text-center p-3">
                                        <h4>{% trans "Cuestionario DD" %} 
                                            {% if usuario.proveedor.cuestionario_dd %}<i class="fa-solid fa-circle-3 text-success"></i>
                                            {% else %}<i class="fa-solid fa-circle-3 text-danger"></i>
                                            {% endif %}
                                        </h4>
                                        <h3></h3>
                                    </div>
                                    
                                </a>
                            </div>   
                          

                        </div>
                        {% else %}
                        <div class="row mt-2">
                            <div class="col-md-4">
                                <a class="text-decoration-none text-dark"  href="{% url 'matriz-oc-proveedores' %}" title="Ordenes de Compra">
                                    <div class="card my-card shadow text-center p-3">
                                        <h4>Ordenes de Compra <i class="fa-solid fa-user"></i></h4>
                                        <h3></h3>
                                    </div>
                                </a>
                            </div>
                            <div class="col-md-4">
                                <a class="text-decoration-none text-dark"  href="{% url 'matriz-direcciones' %}" title="Auditor√≠a de Proveedores">
                                    <div class="card my-card shadow text-center p-3">
                                        <h4>Informaci√≥n <i class="fa-solid fa-user"></i></h4>
                                        <h3></h3>
                                    </div>
                                </a>
                            </div>
                            <div class="col-md-4">
                                <a id="btnVerPolitica" type="button" class="text-decoration-none text-dark" class="btn btn-outline-info"  title="Pol√≠ticas y C√≥digos">
                                    <div class="card my-card shadow text-center p-3">
                                        <h4>Pol√≠ticas y C√≥digos <i class="fa-duotone fa-solid fa-book"></i></h4>
                                        <h3></h3>
                                    </div>
                                </a>
                            </div>
                            <div class="col-md-4 mt-2">
                                <a class="text-decoration-none text-dark"  href="{% url 'cuestionario' usuario.proveedor.id %}">
                                    <div class="card my-card shadow text-center p-3">
                                        <h4>{% trans "Cuestionario DD" %} 
                                            {% if usuario.proveedor.cuestionario_dd %}<i class="fa-solid fa-circle-3 text-success"></i>
                                            {% else %}<i class="fa-solid fa-circle-3 text-danger"></i>
                                            {% endif %}
                                        </h4>
                                        <h3></h3>
                                    </div>
                                </a>
                            </div>
                            {% if invitaciones_direccion %}
                                <div class="col-md-4 mt-2">
                                    <a class="text-decoration-none text-dark" href="{% url 'registro-solo-direccion' usuario.proveedor.id %}">
                                        <div class="card my-card shadow text-center p-3">
                                        <h4>
                                            Agregar direcci√≥n 
                                        </h4>
                                        <h3></h3>
                                        </div>
                                    </a>
                                </div>
                            {% endif %}
                        </div>
                        {% endif %}
                    
                   
                    {% endif %}
                    {% if usuario.tipo.proveedor_externo == False %}
                        {% if usuario.tipo.subdirector %}
                       
                            <div class="row mt-2">
                                 <div class="col-md-4">
                                    <a class="text-decoration-none text-dark" href="{% url 'vales-rosa-pendientes-autorizar' %}">
                                        <div class="card my-card shadow text-center p-3">
                                            <h4>Vales por Autorizar </h4>
                                            {% if conteo_vales == 0 %}
                                            <h3><span class="badge bg-primary"><i class="fa-solid fa-mug-hot"></i></span></h3>
                                            {% else %}
                                            <h3><span class="badge bg-danger">({{conteo_vales}})</span></h3>
                                            {% endif %}
                                        </div>
                                    </a>
                                </div>
                                
                            </div>
                        {% endif %}
                    {% endif %}
                </div>
                  <!-- Modal con visor de PDF -->
                  
            </div>
            <div class="modal fade" id="pdfModal" tabindex="-1" aria-labelledby="pdfModalLabel" aria-hidden="true" data-bs-backdrop="static" data-bs-keyboard="false">
                <div class="modal-dialog modal-xl">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title" id="pdfModalLabel">Pol√≠tica Antisoborno</h5>
                            <!--<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>-->
                        </div>
                        <div class="modal-body p-0">
                            <iframe id="iframePolitica" src="" style="border:none;" width="100%" height="750px"></iframe>
                        </div>
                        <div class="modal-footer">
                            <div class="form-check me-auto">
                              <label id="labelPolitica" class="form-check-label" for="checkAceptar">
                                Acepto haber le√≠do y comprendido la pol√≠tica antisoborno.
                              </label>
                            </div>
                            <button type="button" class="btn btn-secondary" id="btnCerrarModal">
                                Cerrar
                            </button>

                              <button type="button" class="btn btn-secondary" id="btnSiguiente">
                                Siguiente
                            </button>
                            <button type="button" class="btn btn-primary" id="btnAceptarPolitica">Aceptar</button>
                        </div>
                    </div>
                </div>
            </div>
            {% if usuario.tipo.proveedor_externo %}
            <div class="modal fade" id="modalInicial" tabindex="-1" aria-labelledby="modalInicialLabel" aria-hidden="true">
                <div class="modal-dialog modal-dialog-centered">
                    <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="modalInicialLabel">Aviso de Privacidad Simplificado</h5>
                    </div>
                    <div class="modal-body">
                       GRUPO VORDCAB, S.A. DE C.V. no comercializa, ni comparte informaci√≥n con terceros. Toda la informaci√≥n plasmada y recabada en nuestro sistema SAVIA ser√° utilizada para los tr√°mites pertinentes de su evaluaci√≥n como proveedor 
                       y resguardada por 10 a√±os misma que ser√° destruida al terminar dicho periodo, a menos que se solicite lo contrario de manera escrita por el presente usuario. 

                        Al continuar utilizando el sistema SAVIA, acepta este Aviso de privacidad en su totalidad y est√° de acuerdo con la recopilaci√≥n, uso y resguardo de sus
                        datos personales. 

                        Para mayor informaci√≥n acerca del tratamiento y de los derechos que puede hacer valer, usted puede acceder al aviso de privacidad integral a trav√©s 
                        de la p√°gina de Internet <a href="https://www.grupovordcab.com/politicas.php" target="_blank" rel="noopener noreferrer">https://www.grupovordcab.com/politicas.php</a>

                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-primary" id="btnCerrarModalInicial">Entendido</button>
                    </div>
                    </div>
                </div>
            </div>
            {% endif %}
        </div>

    </div>
    
</div>
<script>
function mostrarModalInicial() {
  return new Promise(resolve => {
    const modalEl = document.getElementById('modalInicial');
    const btnCerrar = document.getElementById('btnCerrarModalInicial');

    // Bootstrap 5 modal
    const modal = new bootstrap.Modal(modalEl, {
      backdrop: 'static',  // no cerrar clic afuera
      keyboard: false      // no cerrar con ESC
    });

    // cuando lo cierran, seguimos
    const onHidden = () => {
      modalEl.removeEventListener('hidden.bs.modal', onHidden);
      resolve();
    };
    modalEl.addEventListener('hidden.bs.modal', onHidden);

    // bot√≥n cerrar
    btnCerrar.addEventListener('click', () => modal.hide(), { once: true });

    modal.show();
  });
}

document.addEventListener('DOMContentLoaded', async function () {
  console.log("=== SCRIPT POLITICAS v2026-02-03 A ===");
  {% if usuario.tipo.proveedor_externo %}
  await mostrarModalInicial();
  {% endif %}

  // 2) Aqu√≠ ya corre lo dem√°s (tu script de pol√≠ticas, etc.)
  console.log("Ya cerraron el modal inicial, ahora s√≠ continuo...");
  const iframe = document.getElementById('iframePolitica');
  const modalElement = document.getElementById('pdfModal');
  const modal = new bootstrap.Modal(modalElement);
  const modalTitle = document.getElementById('pdfModalLabel');
  const btnAceptar = document.getElementById('btnAceptarPolitica');
  const labelPolitica = document.getElementById('labelPolitica');
  const btnVerPolitica = document.getElementById('btnVerPolitica');
  const btnCerrarModal = document.getElementById('btnCerrarModal');
  const btnSiguiente = document.getElementById('btnSiguiente');
  const csrfToken = document.querySelector('meta[name="csrf-token"]').content;
  btnCerrarModal.addEventListener('click', function () {
        modal.hide();
    });


  btnSiguiente.addEventListener('click', function () {
  indiceActual++;

    if (indiceActual < politicas.length) {
        mostrarPolitica(indiceActual);
    } else {
        modal.hide(); // ya no hay m√°s pol√≠ticas
    }
    });

    btnAceptar.addEventListener('click', function () {
        const politica = politicas[indiceActual];
        if (!politica) return;

        // üîí Si ya estaba aceptada, no hace nada
        if (politica.aceptada) return;

        fetch("{% url 'aceptar-politica' %}", {
            method: 'POST',
            headers: {
            'Content-Type': 'application/json',
            'X-CSRFToken': csrfToken
            },
            body: JSON.stringify({ clave: politica.clave })
        })
        .then(r => {
            if (!r.ok) throw new Error("Error al aceptar pol√≠tica");
            return r.json();
        })
        .then(() => {
            // ‚úÖ actualiza estado local
            politicas[indiceActual].aceptada = true;

            // ‚úÖ feedback inmediato
            btnAceptar.disabled = true;
            btnAceptar.textContent = "Ya aceptada";
            btnAceptar.classList.remove('btn-primary');
            btnAceptar.classList.add('btn-success');
        })
        .catch(err => {
            console.error(err);
            alert("No se pudo registrar la aceptaci√≥n");
        });
    });

  let politicas = [];
  let indiceActual = 0;

  function cargarPoliticasYMostrar(forzarMostrarAunqueAceptadas = false) {
    return fetch("{% url 'politicas-pendientes' %}")
      .then(r => r.json())
      .then(data => {
        politicas = data || [];

        if (politicas.length === 0) return;

        const idxPendiente = politicas.findIndex(p => p.aceptada === false);

        // ‚úÖ si hay pendientes, muestra la primera pendiente
        // ‚úÖ si NO hay pendientes:
        //   - si forzarMostrarAunqueAceptadas=true, muestra la primera
        //   - si no, no hace nada
        if (idxPendiente !== -1) {
          indiceActual = idxPendiente;
          mostrarPolitica(indiceActual);
        } else if (forzarMostrarAunqueAceptadas) {
          indiceActual = 0;
          mostrarPolitica(indiceActual);
        } else {
          console.log("Todo aceptado, no se fuerza modal.");
        }
      })
      .catch(err => console.error("Error politicas-pendientes:", err));
  }

  function mostrarPolitica(indice) {

  if (indice >= politicas.length) {
    modal.hide();
    return;
  }

  const politica = politicas[indice];
  console.log("Mostrando:", politica);

  fetch(politica.url)
    .then(res => res.json())
    .then(data => {

      // 1Ô∏è‚É£ Cargar el PDF
      const pdfUrl = new URL((data.url || "").replace(/\\/g,'/'), window.location.origin).toString();
      iframe.src = pdfUrl + "#zoom=80";

      // 2Ô∏è‚É£ T√≠tulo
      modalTitle.textContent = politica.nombre;

      // 3Ô∏è‚É£ Texto del label
      const articulo = (politica.nombre === "Aviso de Privacidad" || politica.nombre === "C√≥digo de √âtica") ? "el" : "la";
      labelPolitica.textContent =
        `Acepto haber le√≠do y comprendido ${articulo} ${politica.nombre.toLowerCase()}.`;

      // 4Ô∏è‚É£ üîë AQU√ç VA el estado del bot√≥n Aceptar
      if (politica.aceptada) {
        btnAceptar.disabled = true;
        btnAceptar.textContent = "Ya aceptada";
        btnAceptar.classList.remove('btn-primary');
        btnAceptar.classList.add('btn-success');
      } else {
        btnAceptar.disabled = false;
        btnAceptar.textContent = "Aceptar";
        btnAceptar.classList.remove('btn-success');
        btnAceptar.classList.add('btn-primary');
      }

      // 5Ô∏è‚É£ Mostrar modal (al final)
      modal.show();
    })
    .catch(err => console.error("Error ver-politica:", err));
}


  // ‚úÖ 1) Auto-abrir SOLO si hay pendientes
  cargarPoliticasYMostrar(false);

  // ‚úÖ 2) Abrir desde el bot√≥n aunque todo est√© aceptado
  // (si quieres que el bot√≥n siempre muestre el modal)
  if (btnVerPolitica) {
    btnVerPolitica.addEventListener('click', function (e) {
      e.preventDefault();
      cargarPoliticasYMostrar(true);
    });
  }
});




</script>
{% endblock %}
</body>
</html>